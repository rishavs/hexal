import std/[parseopt, rdstdin]
import compiler/charparser

var opts = initOptParser()
var args : seq[string]

let hexalLogo2 = """
                          
   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘        â–ˆâ–‘@â–‘â–ˆ    
      â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â–€â–ˆâ–€    â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„ 
   â–‘â–‘â–‘â–‘â–‘â–‘  O    O     â–ˆ     â–ˆâ–‘â–‘â–ˆâ–„â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–‘â–‘â–„â–„â–„â–ˆâ–‘â–‘â–€â–ˆâ–€â–‘â–‘â–„â–‘â–‘â–„â–‘â–‘â–‘â–„â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–€â–ˆ    
â–ˆâ–ˆâ–Œ   â–‘â–‘â–‘â–ˆâ–ˆâ–€â–€â–€ â–€â–€â–Œ   â–ˆâ–ˆâ–Œ    â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–‘â–‘â–‘â–ˆâ–„â–„â–„â–ˆâ–ˆâ–„â–‘â–‘â–‘â–„â–ˆâ–ˆâ–‘â–ˆâ–„â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  
   â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–„â–„â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ â–ˆ     â–ˆ  â–„â–„â–„  â–ˆ    â–„â–„â–„â–ˆâ–ˆ  â–€  â–ˆâ–ˆ      â–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 
      â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘    â–ˆ     â–ˆ  â–ˆ â–ˆ  â–ˆ   â–ˆâ–„â–„â–„â–ˆ   â–ˆ   â–ˆ  â–ˆ   â–ˆ       â–ˆ
   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘    â–ˆ     â–ˆâ–„â–„â–ˆâ–„â–ˆâ–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–ˆâ–ˆâ–ˆâ–„â–„â–ˆâ–„â–„â–ˆâ–„â–„â–„â–ˆâ–„â–„â–„â–„â–„â–„â–„â–ˆ    Language v0.1.0
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–Œâ–‘â–‘â–‘â–ˆâ–ˆâ–Œ    â–ˆ     ____________________________________________________________
"""

let hexalLogo = """

       â–„â–€â–„     â–„â–€â–„
      â–„â–ˆâ–‘â–‘â–€â–€â–€â–€â–€â–‘â–‘â–ˆâ–„
      â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆ               v0.1.0
  â–„â–„ >â–ˆâ–‘â–‘â–€â–‘â–‘â”¬â–‘â–‘â–€â–‘â–‘â–ˆ< â–„â–„
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 
â–ˆâ–ˆâ–‘â–‘â–ˆâ–„â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–‘â–‘â–„â–„â–„â–ˆâ–‘â–‘â–€â–ˆâ–€â–‘â–‘â–„â–‘â–‘â–„â–‘â–‘â–‘â–„â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–€â–ˆ    
â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–‘â–‘â–‘â–ˆâ–„â–„â–„â–ˆâ–ˆâ–„â–‘â–‘â–‘â–„â–ˆâ–ˆâ–‘â–ˆâ–„â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  
â–ˆâ–ˆ  â–„â–„â–„  â–ˆ    â–„â–„â–„â–ˆâ–ˆ  â–€  â–ˆâ–ˆ      â–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 
â–ˆâ–ˆ  â–ˆ â–ˆ  â–ˆ   â–ˆâ–„â–„â–„â–ˆ   â–ˆ   â–ˆ  â–ˆ   â–ˆ       â–ˆ
â–ˆâ–ˆâ–„â–„â–ˆâ–„â–ˆâ–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–ˆâ–ˆâ–ˆâ–„â–„â–ˆâ–„â–„â–ˆâ–„â–„â–„â–ˆâ–„â–„â–„â–„â–„â–„â–„â–ˆ    
â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€
"""

# """

#           â–„â–€â–„     â–„â–€â–„
#          â–„â–ˆâ–‘â–‘â–€â–€â–€â–€â–€â–‘â–‘â–ˆâ–„
#          â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆ
#      â–„â–„ >â–ˆâ–‘â–‘â–€â–‘â–‘â”¬â–‘â–‘â–€â–‘â–‘â–ˆ< â–„â–„
    # â–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 
    # â–ˆâ–‘â–‘â–ˆâ–„â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–‘â–‘â–„â–„â–„â–ˆâ–‘â–‘â–€â–ˆâ–€â–‘â–‘â–„â–‘â–‘â–„â–‘â–‘â–‘â–„â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–€â–ˆ    
    # â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–‘â–‘â–‘â–ˆâ–„â–„â–„â–ˆâ–ˆâ–„â–‘â–‘â–‘â–„â–ˆâ–ˆâ–‘â–ˆâ–„â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  
    # â–ˆ  â–„â–„â–„  â–ˆ    â–„â–„â–„â–ˆâ–ˆ  â–€  â–ˆâ–ˆ      â–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 
    # â–ˆ  â–ˆ â–ˆ  â–ˆ   â–ˆâ–„â–„â–„â–ˆ   â–ˆ   â–ˆ  â–ˆ   â–ˆ       â–ˆ
    # â–ˆâ–„â–„â–ˆâ–„â–ˆâ–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–ˆâ–ˆâ–ˆâ–„â–„â–ˆâ–„â–„â–ˆâ–„â–„â–„â–ˆâ–„â–„â–„â–„â–„â–„â–„â–ˆ    Language v0.1.0
    # â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€

        #    â–ˆâ–€â–€â–€â–ˆâ–Œâ–„â–„
        #    â–€â–ˆâ–Œâ–’â–‘â–‘  â–€â–€â–€â–ˆâ–Œâ–„â–„
        #     â–€â–ˆâ–ˆâ–’â–’â–’â–’â–‘    â–â–’â–’â–€â–ˆâ–Œâ–„â–„â–„â–„
        #       â–“â–ˆâ–’â–’â–’â–’â–’â–’â–    â–‘â–’â–’â–’â–’â–â–ˆâ–ˆâ–Œ
        #    â–ˆâ–ˆâ–“â–€â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–€â–ˆâ–ˆ
        #  â–â–ˆâ–€â–‘â–â–„â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–„â–ˆâ–ˆâ–€ â–ˆâ–ˆ
        #     â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–€â–€â–€â–€â–€â–‘â–‘â–„â–ˆâ–ˆâ–„
        #     â–ˆâ–Œ â–‘â–‘â–‘    â–ˆâ–ˆâ–ˆâ–„â–‘â–‘â–‘â–ˆâ–Œ  â–ˆâ–Œ
        #     â–ˆâ–Œâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–€â–€â–‘â–‘â–‘â–€â–ˆâ–ˆâ–ˆâ–ˆâ–Œ
        #     â–ˆâ–ˆâ–„â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–„â–„â–‘â–‘â–‘â–ˆâ–Œâ–â–ˆ
        #      â–â–ˆâ–‘â–‘â–‘â–‘â–‘â–â–ˆâ–€â–€â–€â–€â–„â–â–ˆâ–€ â–â–ˆ
        #    â–„â–ˆâ–ˆâ–€â–ˆâ–„â–‘â–‘â–„â–ˆâ–€â–‘â–„â–ˆâ–ˆâ–€â–€â–‘â–‘â–‘â–â–ˆâ–„
        #    â–ˆâ–ˆâ–„â–„â–„â–ˆâ–ˆâ–ˆâ–ˆâ–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–ˆâ–Œ
# """
# """
#
 
# ïº©ï¼|ã€
# (ï¾Ÿï½¤ ã€‚ 7
# ï¸± ï¸¶ãƒ½     
# _U U c )ãƒŽ
#    _________________________________
#      ðŸ…· ðŸ…´ ðŸ†‡ al Language    v0.1.0
#    Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì… Ì…
#   _                             _ 
#  | |__     ___  __  __   __ _  | |
#  | '_ \   / _ \ \ \/ /  / _` | | |
#  | | | | |  __/  >  <  | (_| | | |
#  |_| |_|  \___| /_/\_\  \__,_| |_|
                                  

# 
# â”€â”€â”€â”€â”€â”€â–„â–€â–„â”€â”€â”€â”€â”€â–„â–€â–„
# â”€â”€â”€â”€â”€â–„â–ˆâ–‘â–‘â–€â–€â–€â–€â–€â–‘â–‘â–ˆâ–„
# â”€â–„â–„â”€â”€â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ”€â”€â–„â–„
# â–ˆâ–„â–„â–ˆâ”€â–ˆâ–‘â–‘â–€â–‘â–‘â”¬â–‘â–‘â–€â–‘â–‘â–ˆâ”€â–ˆâ–„â–„â–ˆ
#  â–„â–„   â–„â–„ â–„â–„â–„â–„â–„â–„â–„ â–„â–„   â–„â–„ â–„â–„â–„â–„â–„â–„ â–„â–„â–„     
# â–ˆ  â–ˆ â–ˆ  â–ˆ       â–ˆ  â–ˆâ–„â–ˆ  â–ˆ      â–ˆ   â–ˆ    
# â–ˆ  â–ˆâ–„â–ˆ  â–ˆ    â–„â–„â–„â–ˆ       â–ˆ  â–„   â–ˆ   â–ˆ    
# â–ˆ       â–ˆ   â–ˆâ–„â–„â–„â–ˆ       â–ˆ â–ˆâ–„â–ˆ  â–ˆ   â–ˆ    
# â–ˆ   â–„   â–ˆ    â–„â–„â–„â–ˆâ–ˆ     â–ˆâ–ˆ      â–ˆ   â–ˆâ–„â–„â–„ 
# â–ˆ  â–ˆ â–ˆ  â–ˆ   â–ˆâ–„â–„â–„â–ˆ   â–„   â–ˆ  â–„   â–ˆ       â–ˆ
# â–ˆâ–„â–„â–ˆ â–ˆâ–„â–„â–ˆâ–„â–„â–„â–„â–„â–„â–„â–ˆâ–„â–„â–ˆ â–ˆâ–„â–„â–ˆâ–„â–ˆ â–ˆâ–„â–„â–ˆâ–„â–„â–„â–„â–„â–„â–„â–ˆ    V0.1.0
# """

let usageText = """
    Usage: hexal [command] [command-arguments] [command-options]
        Commands:                               Description:
            hexal                         
                â”œ repl                          "Run the REPL"
                â”œ compile [file] [options]      "Compile a file into an executable"
                â”” info                          "See the hexal installation information"
"""

echo hexalLogo

parse("test")

for kind, key, val in opts.getopt():
    case kind
    of cmdArgument:
        echo key
        args.add(key)
    of cmdLongOption, cmdShortOption:
        case key
        of "help", "h": echo "Helping..."
        of "version", "v": echo "Versioning..."
    of cmdEnd: break


if args.len != 0:
    case args[0]
    of "compile":
        echo "Compiling... "
    of "repl":
        echo "Running REPL..."

        var line: string
        while true:
            let ok = readLineFromStdin("hexal>  ", line)
            if not ok: break # ctrl-C or ctrl-D will cause a break
            if line.len > 0: 
                # source = line
                
                echo "Interpreting:     "
            echo ""
        echo "exiting"
    else:
        echo "Unknown command: ", args[0]
        echo "Hexal doesn't knows this spell!"
        echo usageText
else:
    echo ""





# case cmd = ARGV[0]:
# of "compile":
#     echo "Compiling program..."
#     echo "Reading File..."
#     code = File.read(ARGV[1])
#     runner = Runner.new(code)
#     runner.run()
# of "repl":
#     echo "Starting REPL"

#     loop do
#         echo "--------------------------------------------------\n"
#         echo "> "

#         line = gets
#         if line.nil?
#             break
#         end
        
#         echo "\n"
#         runner = Runner.new(line)
#         runner.run()
#     end
# of "init", "install", "run", "update":
#     raise Exception.new("'#{cmd}' Command has not yet been implemented")
# else :
#     raise Exception.new("Unrecognized command '#{cmd}'")
# end